<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MONKEYMAN.DEV | File Sorter Pro</title>
    <style>
        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f0f0f0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; margin: 0; overflow: hidden; user-select: none;
        }

        #game-container {
            width: 600px; height: 700px;
            background-color: #ffffff; border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative; overflow: hidden; touch-action: none; 
        }

        #game-area {
            width: 100%; height: 100%; position: relative;
            background: linear-gradient(to bottom, #e0e0e0, #ffffff 70%);
        }

        /* Target Boxes */
        .box-container {
            position: absolute; bottom: 20px; width: 100%;
            display: flex; justify-content: space-around;
        }

        .target-box {
            position: relative; width: 123px; height: 106px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        .box-img { width: 123px; height: 106px; image-rendering: pixelated; position: absolute; }
        .box-label { position: relative; z-index: 5; font-weight: bold; font-size: 14px; margin-top: 20px; text-shadow: 1px 1px 0px white; }

        /* Falling Files */
        .file-wrapper {
            position: absolute; width: 70px; height: 70px;
            display: flex; align-items: center; justify-content: center;
            cursor: grab; z-index: 10;
        }
        .file-img { width: 100%; height: 100%; image-rendering: pixelated; position: absolute; }
        .file-label { position: relative; z-index: 11; font-weight: bold; font-size: 12px; color: #333; pointer-events: none; }

        /* UI & Menus */
        #ui-layer { position: absolute; top: 15px; left: 20px; z-index: 20; }
        .ui-text { font-size: 18px; font-weight: bold; margin: 0; }
        #score-board { color: #d16b47; }
        #high-score-board { color: #888; font-size: 14px; }
        #lives-display { color: #e74c3c; margin-top: 5px; }

        #pause-btn { position: absolute; top: 15px; right: 20px; z-index: 20; padding: 8px 15px; width: auto; display: none; }

        .message-popup {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(240, 240, 240, 0.98); display: none; flex-direction: column;
            align-items: center; justify-content: center; z-index: 100; text-align: center;
        }

        .menu-panel {
            background: white; border: 4px solid #333; border-radius: 10px;
            padding: 30px; width: 80%; max-width: 420px;
            box-shadow: 0px 8px 0px #ccc; position: relative;
        }

        .main-logo { width: 350px; height: auto; image-rendering: pixelated; margin-bottom: 20px; }
        .thinking-monkey { position: absolute; top: -60px; right: -30px; width: 120px; image-rendering: pixelated; z-index: 101; }

        .made-by {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: bold;
            color: #bbb;
            letter-spacing: 2px;
            z-index: 105;
            transition: color 0.3s;
        }
        .made-by:hover { color: #d16b47; }

        /* Buttons */
        .btn {
            display: block; width: 100%; margin: 10px 0;
            padding: 15px 20px; font-size: 1.2rem; font-family: 'Courier New', Courier, monospace;
            font-weight: bold; color: white; background-color: #333;
            border: 4px solid #111; border-radius: 8px; cursor: pointer;
            box-shadow: 0px 5px 0px #111; transition: all 0.1s;
        }
        .btn:active { transform: translateY(5px); box-shadow: 0px 0px 0px #111; }
        .btn-primary { background-color: #d16b47; border-color: #8a462d; box-shadow: 0px 5px 0px #8a462d; }
        .diff-btn { background-color: #ccc; color: #333; }
        .diff-btn.active { background-color: #2ecc71; color: white; border-color: #27ae60; box-shadow: 0px 5px 0px #27ae60; }

        .volume-container { margin: 20px 0; font-weight: bold; }
        #volume-control { width: 100%; cursor: pointer; accent-color: #d16b47; }
        
        ul.instr-list { text-align: left; font-size: 13px; line-height: 1.4; padding-left: 15px; }

        /* Shake Effect */
        .shake { animation: shake 0.3s; }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            50% { transform: translate(-1px, 2px) rotate(1deg); }
            100% { transform: translate(1px, 1px) rotate(0deg); }
        }

        /* Easter Egg Styles */
        #love-letter-screen .menu-panel {
            border-color: #e74c3c;
            box-shadow: 0px 8px 0px #c0392b;
            padding-bottom: 60px; /* Extra space for the bigger flower */
            overflow: visible; /* Allow the flower to stick out! */
        }
        .heart-pulse { animation: pulse 1s infinite; }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }

        /* UPDATED FLOWER STYLING */
        .flower-img {
            position: absolute;
            bottom: -40px; /* Push it outside the bottom */
            left: -50px;   /* Push it outside the left */
            width: 150px;  /* Much bigger size */
            height: auto;
            image-rendering: pixelated;
            transform: rotate(-25deg); /* Tilt it */
            z-index: 10; /* Ensure it sits on top of the border */
            filter: drop-shadow(3px 3px 3px rgba(0,0,0,0.2)); /* Add a nice shadow for depth */
        }
    </style>
</head>
<body>

    <audio id="menu-music" loop><source src="menu_music.mp3" type="audio/mpeg"></audio>
    <audio id="bg-music" loop><source src="bg_music.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-gameover"><source src="gameover.mp3" type="audio/mpeg"></audio>
    <audio id="lovesong-music" loop><source src="lovesong.mp3" type="audio/mpeg"></audio>

    <div id="game-container">
        <div id="game-area">
            <div class="box-container">
                <div class="target-box" data-category="image"><img src="file_box.png" class="box-img"><span class="box-label" style="color: #2ecc71;">IMAGES</span></div>
                <div class="target-box" data-category="video"><img src="file_box.png" class="box-img"><span class="box-label" style="color: #e74c3c;">VIDEOS</span></div>
                <div class="target-box" data-category="document"><img src="file_box.png" class="box-img"><span class="box-label" style="color: #3498db;">DOCS</span></div>
            </div>
        </div>

        <div id="ui-layer">
            <p class="ui-text" id="score-board">SCORE: <span id="score-value">0</span></p>
            <p class="ui-text" id="high-score-board">BEST: <span id="high-score-value">0</span></p>
            <p class="ui-text" id="lives-display">LIVES: <span id="lives-value">5</span></p>
        </div>
        
        <button class="btn btn-primary" id="pause-btn">|| PAUSE</button>

        <div class="message-popup" id="start-screen" style="display: flex;">
            <div class="made-by">MADE BY</div>
            <img src="monkeyman.png" class="main-logo">
            <div style="width: 250px;">
                <button class="btn btn-primary" id="start-button">START GAME</button>
                <button class="btn" id="btn-howto">HOW TO PLAY</button>
                <button class="btn" id="btn-settings">SETTINGS</button>
            </div>
            <p style="font-size: 10px; margin-top: 15px; color: #aaa;">CLICK ANYWHERE TO ENABLE SOUND</p>
        </div>

        <div class="message-popup" id="howto-screen">
            <div class="menu-panel">
                <img src="thinkingmonkey.png" class="thinking-monkey">
                <h2 style="color: #d16b47; border-bottom: 2px solid #333; padding-bottom: 5px;">SYSTEM MANUAL</h2>
                <div style="text-align: left; font-size: 13px;">
                    <p><strong>GOAL:</strong> Sort falling files into the correct bins!</p>
                    <ul class="instr-list">
                        <li>.PNG / .JPG → <span style="color: #2ecc71;">IMAGES</span></li>
                        <li>.MP4 / .MOV → <span style="color: #e74c3c;">VIDEOS</span></li>
                        <li>.PDF / .TXT → <span style="color: #3498db;">DOCS</span></li>
                    </ul>
                    <p>✅ Correct: +10 Points | ❌ Wrong: -1 Life</p>
                </div>
                <button class="btn btn-primary btn-back" data-target="howto-screen">I'M READY!</button>
            </div>
        </div>

        <div class="message-popup" id="love-letter-screen">
            <div class="menu-panel">
                <h2 style="color: #e74c3c;">❤️ MY FAVORITE PERSON ❤️</h2>
                <div style="text-align: center; font-size: 14px; line-height: 1.6; padding: 10px; color: #333;">
                    <p>Every time I see you, it’s like my heart resets. I don't know how you do it, but I find myself falling in love with you all over again the second you walk into the room.</p>
                    <p>I am so incredibly thankful to have you by my side, and I want you to know that I will never get tired of telling you how much I love you. You’re my favorite person, today and every day.</p>
                </div>
                <img src="flower.png" class="flower-img"> <button class="btn btn-primary" id="btn-close-letter" style="background-color: #e74c3c; border-color: #c0392b;">BACK TO GAME</button>
            </div>
        </div>

        <div class="message-popup" id="settings-screen">
            <div class="menu-panel">
                <h2>SETTINGS</h2>
                <div class="volume-container">
                    <label>MASTER VOLUME</label>
                    <input type="range" id="volume-control" min="0" max="1" step="0.1" value="0.5">
                </div>
                <label>DIFFICULTY</label>
                <div style="display: flex; gap: 5px;">
                    <button class="btn diff-btn" data-diff="easy">EASY</button>
                    <button class="btn diff-btn active" data-diff="normal">NORM</button>
                    <button class="btn diff-btn" data-diff="hard">HARD</button>
                </div>
                <button class="btn btn-primary btn-back" data-target="settings-screen">BACK</button>
            </div>
        </div>

        <div class="message-popup" id="pause-screen">
            <div class="menu-panel">
                <h2>PAUSED</h2>
                <button class="btn btn-primary" id="btn-resume">RESUME</button>
                <button class="btn" id="btn-quit">MAIN MENU</button>
            </div>
        </div>

        <div class="message-popup" id="end-screen">
            <h2 id="end-title">SYSTEM OVERLOAD</h2>
            <p id="end-score">Score: 0</p>
            <p id="new-record" style="color: #2ecc71; font-weight: bold; display: none;">NEW RECORD!</p>
            <button class="btn btn-primary" id="restart-button">MAIN MENU</button>
        </div>
    </div>

    <script>
        window.addEventListener('load', () => {
            const gameContainer = document.getElementById('game-container');
            const gameArea = document.getElementById('game-area');
            const menuMusic = document.getElementById('menu-music');
            const gameMusic = document.getElementById('bg-music');
            const gameOverSfx = document.getElementById('sfx-gameover');
            const lovesongMusic = document.getElementById('lovesong-music');
            const volumeControl = document.getElementById('volume-control');
            const highScoreText = document.getElementById('high-score-value');
            const targetBoxes = document.querySelectorAll('.target-box');
            
            let score = 0, lives = 5, gameActive = false, activeFiles = [];
            let draggedFile = null, spawnTimer, fallSpeed = 2.5, spawnInterval = 1300;
            let highScore = localStorage.getItem('monkeyHighScore') || 0;
            let easterEggTriggered = false; 

            highScoreText.textContent = highScore;

            function setMasterVolume(v) {
                menuMusic.volume = v;
                gameMusic.volume = v;
                gameOverSfx.volume = v;
                lovesongMusic.volume = v;
            }
            setMasterVolume(0.5);

            function unlockAudio() {
                if (menuMusic.paused && !gameActive) {
                    menuMusic.play();
                    document.removeEventListener('click', unlockAudio);
                }
            }
            document.addEventListener('click', unlockAudio);

            volumeControl.addEventListener('input', (e) => { setMasterVolume(e.target.value); });

            document.getElementById('start-button').onclick = () => {
                menuMusic.pause();
                menuMusic.currentTime = 0;
                startGame();
                gameMusic.play();
            };

            document.getElementById('btn-howto').onclick = () => document.getElementById('howto-screen').style.display = 'flex';
            document.getElementById('btn-settings').onclick = () => document.getElementById('settings-screen').style.display = 'flex';
            document.getElementById('pause-btn').onclick = pauseGame;
            document.getElementById('btn-resume').onclick = resumeGame;
            document.getElementById('btn-quit').onclick = () => location.reload();
            document.getElementById('restart-button').onclick = () => location.reload();

            document.querySelectorAll('.btn-back').forEach(btn => btn.onclick = () => document.getElementById(btn.dataset.target).style.display = 'none');

            function startGame() {
                score = 0; lives = 5; gameActive = true; easterEggTriggered = false;
                document.getElementById('start-screen').style.display = 'none';
                document.getElementById('pause-btn').style.display = 'block';
                spawnTimer = setInterval(spawnFile, spawnInterval);
                renderLoop();
            }

            function spawnFile() {
                if (!gameActive) return;
                const wrapper = document.createElement('div');
                wrapper.className = 'file-wrapper';

                // --- EASTER EGG TRIGGER AT 150 ---
                if (score >= 150 && !easterEggTriggered) {
                    easterEggTriggered = true;
                    wrapper.innerHTML = `<img src="heart.png" class="file-img heart-pulse">`;
                    wrapper.dataset.category = 'heart';
                } else {
                    const types = [
                        {ext:'.PNG', cat:'image'}, {ext:'.JPG', cat:'image'},
                        {ext:'.MP4', cat:'video'}, {ext:'.MOV', cat:'video'},
                        {ext:'.PDF', cat:'document'}, {ext:'.TXT', cat:'document'}
                    ];
                    const data = types[Math.floor(Math.random() * types.length)];
                    wrapper.innerHTML = `<img src="file_icon.png" class="file-img"><span class="file-label">${data.ext}</span>`;
                    wrapper.dataset.category = data.cat;
                }

                wrapper.style.left = Math.random() * (gameArea.clientWidth - 70) + 'px';
                wrapper.style.top = '-70px';
                wrapper.addEventListener('mousedown', startDrag);
                wrapper.addEventListener('touchstart', startDrag, { passive: false });
                gameArea.appendChild(wrapper);
                activeFiles.push(wrapper);
            }

            function renderLoop() {
                if (!gameActive) return;
                activeFiles.forEach(file => {
                    if (file === draggedFile) return;
                    let top = parseFloat(file.style.top) + fallSpeed;
                    file.style.top = top + 'px';
                    
                    if (top > gameArea.clientHeight) { 
                        if (file.dataset.category === 'heart') {
                            easterEggTriggered = false; 
                        } else {
                            triggerPenalty(); 
                        }
                        removeFile(file); 
                        updateUI(); 
                    }
                });
                if (lives <= 0) endGame();
                else requestAnimationFrame(renderLoop);
            }

            function triggerPenalty() {
                lives--;
                gameContainer.classList.add('shake');
                setTimeout(() => gameContainer.classList.remove('shake'), 300);
            }

            function startDrag(e) {
                if (!gameActive) return;
                if (e.cancelable) e.preventDefault();
                draggedFile = e.currentTarget;
                const rect = gameArea.getBoundingClientRect();
                const move = (ev) => {
                    const cx = ev.clientX || (ev.touches ? ev.touches[0].clientX : 0);
                    const cy = ev.clientY || (ev.touches ? ev.touches[0].clientY : 0);
                    draggedFile.style.left = (cx - rect.left - 35) + 'px';
                    draggedFile.style.top = (cy - rect.top - 35) + 'px';
                };
                const up = () => {
                    document.removeEventListener('mousemove', move);
                    document.removeEventListener('mouseup', up);
                    document.removeEventListener('touchmove', move);
                    document.removeEventListener('touchend', up);
                    if (draggedFile) {
                        let hitCat = null;
                        targetBoxes.forEach(box => {
                            const bRect = box.getBoundingClientRect();
                            const fRect = draggedFile.getBoundingClientRect();
                            if (!(fRect.right < bRect.left-50 || fRect.left > bRect.right+50 || fRect.bottom < bRect.top-50 || fRect.top > bRect.bottom+50)) hitCat = box.dataset.category;
                        });

                        if (hitCat) {
                            if (draggedFile.dataset.category === 'heart') {
                                triggerLoveLetter();
                            } else {
                                if (hitCat === draggedFile.dataset.category) score += 10;
                                else { score -= 5; triggerPenalty(); }
                            }
                            removeFile(draggedFile); updateUI();
                        }
                    }
                    draggedFile = null;
                };
                document.addEventListener('mousemove', move);
                document.addEventListener('mouseup', up);
                document.addEventListener('touchmove', move, { passive: false });
                document.addEventListener('touchend', up);
            }

            function triggerLoveLetter() {
                gameActive = false;
                clearInterval(spawnTimer);
                gameMusic.pause();
                lovesongMusic.play();
                document.getElementById('love-letter-screen').style.display = 'flex';
            }

            document.getElementById('btn-close-letter').onclick = () => {
                document.getElementById('love-letter-screen').style.display = 'none';
                lovesongMusic.pause();
                lovesongMusic.currentTime = 0;
                resumeGame();
            };

            function pauseGame() { 
                gameActive = false; clearInterval(spawnTimer); gameMusic.pause();
                document.getElementById('pause-screen').style.display = 'flex'; 
            }

            function resumeGame() { 
                document.getElementById('pause-screen').style.display = 'none'; 
                gameActive = true; gameMusic.play();
                spawnTimer = setInterval(spawnFile, spawnInterval); renderLoop(); 
            }

            function removeFile(f) { f.remove(); activeFiles = activeFiles.filter(i => i !== f); }
            function updateUI() { document.getElementById('score-value').textContent = score; document.getElementById('lives-value').textContent = lives; }

            function endGame() {
                gameActive = false; clearInterval(spawnTimer);
                gameMusic.pause(); gameMusic.currentTime = 0;
                gameOverSfx.play();
                document.getElementById('end-score').textContent = `Final Score: ${score}`;
                if (score > highScore) {
                    highScore = score; localStorage.setItem('monkeyHighScore', highScore);
                    document.getElementById('new-record').style.display = 'block';
                }
                document.getElementById('end-screen').style.display = 'flex';
                gameOverSfx.onended = () => { menuMusic.play(); };
            }

            document.querySelectorAll('.diff-btn').forEach(btn => {
                btn.onclick = (e) => {
                    document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    const d = e.target.dataset.diff;
                    if (d === 'easy') { fallSpeed = 1.5; spawnInterval = 1800; }
                    else if (d === 'normal') { fallSpeed = 2.5; spawnInterval = 1300; }
                    else if (d === 'hard') { fallSpeed = 4.0; spawnInterval = 800; }
                };
            });
        });
    </script>
</body>
</html>
